# ============================================
# TypeScript Coverage Improvement System
# Environment Configuration
# ============================================
# Copy this file to .env and configure with your actual values
# Never commit .env to version control!

# ============================================
# GitHub Configuration
# ============================================
# Personal Access Token (PAT) Authentication
# Create token at: https://github.com/settings/tokens
# Required scopes: repo (full) OR Contents + Pull requests (fine-grained)
GITHUB_TOKEN=ghp_YourPersonalAccessTokenHere

# GitHub App Authentication (alternative to PAT)
# Recommended for organization-level deployments
# See docs/GITHUB_SETUP.md for GitHub App setup
# GITHUB_APP_ID=123456
# GITHUB_APP_PRIVATE_KEY_PATH=./github-app-key.pem
# GITHUB_INSTALLATION_ID=789012

# ============================================
# Database Configuration
# ============================================
# Path to SQLite database file
DATABASE_PATH=./data/coverage.db

# ============================================
# Coverage Configuration
# ============================================
# Minimum coverage percentage threshold (0-100)
# Files below this threshold will be flagged for improvement
COVERAGE_THRESHOLD=80

# Command to run coverage analysis (default uses nyc)
COVERAGE_COMMAND=npm run test:cov

# NYC coverage report directory
NYC_REPORT_DIR=./coverage

# ============================================
# AI CLI Configuration
# ============================================
# Enable Docker isolation for AI CLI execution (recommended)
AI_USE_DOCKER=true

# AI CLI command with placeholders
# Available placeholders:
#   {repo}  - Path to cloned repository
#   {file}  - Target file for test generation
#   {out}   - Output directory for generated tests
#   {image} - Docker image name (when AI_USE_DOCKER=true)
#
# Docker example (recommended):
AI_CLI_CMD=docker run --rm -v {repo}:/workspace {image} generate --target {file} --out {out}
#
# Local CLI example (less secure):
# AI_CLI_CMD=ai-test-generator --file {file} --output {out} --format jest

# API key for AI service (if required by your AI CLI)
AI_CLI_KEY=your-ai-api-key-here

# ============================================
# Docker Isolation Settings
# ============================================
# These settings apply when AI_USE_DOCKER=true

# Enable Docker isolation for AI CLI execution
# STRONGLY RECOMMENDED: Runs AI CLI in sandboxed container with limited resources
USE_DOCKER_ISOLATION=true

# Docker image for AI CLI execution (legacy, prefer AI_DOCKER_IMAGE)
DOCKER_AI_IMAGE=node:18-alpine

# Memory limit for AI CLI container (prevents resource exhaustion)
DOCKER_MEMORY_LIMIT=1g

# CPU limit for AI CLI container (1.0 = 1 full CPU core)
DOCKER_CPU_LIMIT=1.0

# Network access mode for AI CLI container
# Options:
#   none   - No network access (maximum security)
#   bridge - Limited network access (recommended)
#   host   - Full network access (use with caution)
DOCKER_NETWORK_MODE=bridge

# Maximum execution time for AI CLI in seconds
DOCKER_TIMEOUT=600

# ============================================
# Temporary Directory Configuration
# ============================================
# Base directory for ephemeral job workspaces
TEMP_BASE_DIR=./tmp/jobs

# Automatic cleanup threshold in hours
TEMP_CLEANUP_HOURS=24

# ============================================
# API Server Configuration
# ============================================
PORT=3000
NODE_ENV=development

# ============================================
# Worker Configuration
# ============================================
# Maximum concurrent jobs per repository
MAX_CONCURRENT_JOBS_PER_REPO=1

# Polling interval for job queue in milliseconds
WORKER_POLL_INTERVAL=5000

# Maximum number of retry attempts for failed jobs
JOB_RETRY_ATTEMPTS=3

# Initial delay between retries in milliseconds
JOB_RETRY_DELAY_MS=5000

# ============================================
# Git Configuration
# ============================================
# Git commit author
GIT_AUTHOR_NAME=Coverage Improvement Bot
GIT_AUTHOR_EMAIL=bot@coverage-improvement.local

# Default branch prefix for improvement PRs
DEFAULT_BRANCH_PREFIX=improve

# ============================================
# Logging Configuration
# ============================================
# Log level (error, warn, info, debug, verbose)
LOG_LEVEL=info

# Enable token redaction in logs (STRONGLY RECOMMENDED)
REDACT_SENSITIVE_LOGS=true

# ============================================
# Security Notes
# ============================================
# 1. TOKEN SECURITY:
#    - Never commit .env file to version control
#    - Rotate tokens regularly
#    - Use GitHub Apps with fine-grained permissions for production
#
# 2. DOCKER ISOLATION:
#    - Always use Docker isolation in production
#    - Limit network access to minimum required
#
# 3. See docs/GITHUB_SETUP.md for detailed security setup
